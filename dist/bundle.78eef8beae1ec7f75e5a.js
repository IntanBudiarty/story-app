/*! For license information please see bundle.78eef8beae1ec7f75e5a.js.LICENSE.txt */
(()=>{"use strict";function t(e){return t="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},t(e)}function e(t,e){for(var n=0;n<e.length;n++){var o=e[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,r(o.key),o)}}function r(e){var r=function(e){if("object"!=t(e)||!e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,"string");if("object"!=t(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==t(r)?r:r+""}const n=function(){return t=function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.userProfileContainer=document.createElement("div"),this.userProfileContainer.className="user-profile"},r=[{key:"showLoading",value:function(){this._getMainContent().innerHTML='\n      <h2>Recent Stories</h2>\n      <div class="loading">\n        <div class="loading-spinner"></div>\n      </div>\n      <div id="map"></div>\n    '}},{key:"showStories",value:function(t){var e=this._getMainContent();if(t&&0!==t.length){var r=t.map((function(t){return'\n      <article class="story-card" data-id="'.concat(t.id,'">\n        ').concat(t.photoUrl?'\n          <img src="'.concat(t.photoUrl,'" \n               alt="').concat(t.name||"Story",'\'s image" \n               class="story-image"\n               onerror="this.remove()"> \x3c!-- Remove image if error --\x3e\n        '):"",'\n        <div class="story-content">\n          <h3 class="story-title">').concat(t.name||"Untitled Story",'</h3>\n          <p class="story-description">').concat(t.description||"No description available",'</p>\n          <div class="story-meta">\n            <span>').concat(t.createdAt?new Date(t.createdAt).toLocaleDateString():"Unknown date","</span>\n            <span>").concat(t.name||"Unknown author",'</span>\n          </div>\n          <button class="view-detail-btn" data-id="').concat(t.id,'">\n            View Detail\n          </button>\n        </div>\n      </article>\n    ')})).join("");e.innerHTML='\n      <h2>Recent Stories</h2>\n      <div class="stories-container">\n        '.concat(r,'\n      </div>\n      <div id="map"></div>\n    '),this._initViewDetailButtons()}else e.innerHTML='\n        <h2>Recent Stories</h2>\n        <p>No stories found. Be the first to share your story!</p>\n        <div id="map"></div>\n      '}},{key:"showError",value:function(t){this._getMainContent().innerHTML='\n      <h2>Recent Stories</h2>\n      <div class="error-message">\n        <p>'.concat(t,'</p>\n        <button onclick="window.location.reload()">Try Again</button>\n      </div>\n    ')}},{key:"showUserProfile",value:function(t){if(t){var e='\n      <div class="user-info">\n        <h3>Welcome, '.concat(t.name||"User",'</h3>\n        <button id="logout-btn" class="btn">Logout</button>\n      </div>\n    '),r=this._getMainContent(),n=r.querySelector(".user-profile");n||((n=document.createElement("div")).className="user-profile",r.prepend(n)),n.innerHTML=e}}},{key:"_initViewDetailButtons",value:function(){document.querySelectorAll(".view-detail-btn").forEach((function(t){t.addEventListener("click",(function(t){var e=t.currentTarget.getAttribute("data-id");e&&(window.location.hash="#/detail/".concat(e))}))}))}},{key:"_getMainContent",value:function(){return document.querySelector("main")||(console.error("Main content element not found"),document.body)}}],r&&e(t.prototype,r),Object.defineProperty(t,"prototype",{writable:!1}),t;var t,r}();function o(t){return o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},o(t)}function i(){i=function(){return e};var t,e={},r=Object.prototype,n=r.hasOwnProperty,a="function"==typeof Symbol?Symbol:{},u=a.iterator||"@@iterator",c=a.asyncIterator||"@@asyncIterator",s=a.toStringTag||"@@toStringTag";function l(t,e,r,n){return Object.defineProperty(t,e,{value:r,enumerable:!n,configurable:!n,writable:!n})}try{l({},"")}catch(t){l=function(t,e,r){return t[e]=r}}function f(e,r,n,o){var i=r&&r.prototype instanceof d?r:d,a=Object.create(i.prototype);return l(a,"_invoke",function(e,r,n){var o=1;return function(i,a){if(3===o)throw Error("Generator is already running");if(4===o){if("throw"===i)throw a;return{value:t,done:!0}}for(n.method=i,n.arg=a;;){var u=n.delegate;if(u){var c=S(u,n);if(c){if(c===p)continue;return c}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if(1===o)throw o=4,n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);o=3;var s=h(e,r,n);if("normal"===s.type){if(o=n.done?4:2,s.arg===p)continue;return{value:s.arg,done:n.done}}"throw"===s.type&&(o=4,n.method="throw",n.arg=s.arg)}}}(e,n,new j(o||[])),!0),a}function h(t,e,r){try{return{type:"normal",arg:t.call(e,r)}}catch(t){return{type:"throw",arg:t}}}e.wrap=f;var p={};function d(){}function y(){}function v(){}var m={};l(m,u,(function(){return this}));var g=Object.getPrototypeOf,w=g&&g(g(O([])));w&&w!==r&&n.call(w,u)&&(m=w);var b=v.prototype=d.prototype=Object.create(m);function E(t){["next","throw","return"].forEach((function(e){l(t,e,(function(t){return this._invoke(e,t)}))}))}function x(t,e){function r(i,a,u,c){var s=h(t[i],t,a);if("throw"!==s.type){var l=s.arg,f=l.value;return f&&"object"==o(f)&&n.call(f,"__await")?e.resolve(f.__await).then((function(t){r("next",t,u,c)}),(function(t){r("throw",t,u,c)})):e.resolve(f).then((function(t){l.value=t,u(l)}),(function(t){return r("throw",t,u,c)}))}c(s.arg)}var i;l(this,"_invoke",(function(t,n){function o(){return new e((function(e,o){r(t,n,e,o)}))}return i=i?i.then(o,o):o()}),!0)}function S(e,r){var n=r.method,o=e.i[n];if(o===t)return r.delegate=null,"throw"===n&&e.i.return&&(r.method="return",r.arg=t,S(e,r),"throw"===r.method)||"return"!==n&&(r.method="throw",r.arg=new TypeError("The iterator does not provide a '"+n+"' method")),p;var i=h(o,e.i,r.arg);if("throw"===i.type)return r.method="throw",r.arg=i.arg,r.delegate=null,p;var a=i.arg;return a?a.done?(r[e.r]=a.value,r.next=e.n,"return"!==r.method&&(r.method="next",r.arg=t),r.delegate=null,p):a:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,p)}function k(t){this.tryEntries.push(t)}function _(e){var r=e[4]||{};r.type="normal",r.arg=t,e[4]=r}function j(t){this.tryEntries=[[-1]],t.forEach(k,this),this.reset(!0)}function O(e){if(null!=e){var r=e[u];if(r)return r.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var i=-1,a=function r(){for(;++i<e.length;)if(n.call(e,i))return r.value=e[i],r.done=!1,r;return r.value=t,r.done=!0,r};return a.next=a}}throw new TypeError(o(e)+" is not iterable")}return y.prototype=v,l(b,"constructor",v),l(v,"constructor",y),y.displayName=l(v,s,"GeneratorFunction"),e.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===y||"GeneratorFunction"===(e.displayName||e.name))},e.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,v):(t.__proto__=v,l(t,s,"GeneratorFunction")),t.prototype=Object.create(b),t},e.awrap=function(t){return{__await:t}},E(x.prototype),l(x.prototype,c,(function(){return this})),e.AsyncIterator=x,e.async=function(t,r,n,o,i){void 0===i&&(i=Promise);var a=new x(f(t,r,n,o),i);return e.isGeneratorFunction(r)?a:a.next().then((function(t){return t.done?t.value:a.next()}))},E(b),l(b,s,"Generator"),l(b,u,(function(){return this})),l(b,"toString",(function(){return"[object Generator]"})),e.keys=function(t){var e=Object(t),r=[];for(var n in e)r.unshift(n);return function t(){for(;r.length;)if((n=r.pop())in e)return t.value=n,t.done=!1,t;return t.done=!0,t}},e.values=O,j.prototype={constructor:j,reset:function(e){if(this.prev=this.next=0,this.sent=this._sent=t,this.done=!1,this.delegate=null,this.method="next",this.arg=t,this.tryEntries.forEach(_),!e)for(var r in this)"t"===r.charAt(0)&&n.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=t)},stop:function(){this.done=!0;var t=this.tryEntries[0][4];if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var r=this;function n(t){a.type="throw",a.arg=e,r.next=t}for(var o=r.tryEntries.length-1;o>=0;--o){var i=this.tryEntries[o],a=i[4],u=this.prev,c=i[1],s=i[2];if(-1===i[0])return n("end"),!1;if(!c&&!s)throw Error("try statement without catch or finally");if(null!=i[0]&&i[0]<=u){if(u<c)return this.method="next",this.arg=t,n(c),!0;if(u<s)return n(s),!1}}},abrupt:function(t,e){for(var r=this.tryEntries.length-1;r>=0;--r){var n=this.tryEntries[r];if(n[0]>-1&&n[0]<=this.prev&&this.prev<n[2]){var o=n;break}}o&&("break"===t||"continue"===t)&&o[0]<=e&&e<=o[2]&&(o=null);var i=o?o[4]:{};return i.type=t,i.arg=e,o?(this.method="next",this.next=o[2],p):this.complete(i)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),p},finish:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r[2]===t)return this.complete(r[4],r[3]),_(r),p}},catch:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r[0]===t){var n=r[4];if("throw"===n.type){var o=n.arg;_(r)}return o}}throw Error("illegal catch attempt")},delegateYield:function(e,r,n){return this.delegate={i:O(e),r,n},"next"===this.method&&(this.arg=t),p}},e}function a(t,e,r,n,o,i,a){try{var u=t[i](a),c=u.value}catch(t){return void r(t)}u.done?e(c):Promise.resolve(c).then(n,o)}function u(t){return function(){var e=this,r=arguments;return new Promise((function(n,o){var i=t.apply(e,r);function u(t){a(i,n,o,u,c,"next",t)}function c(t){a(i,n,o,u,c,"throw",t)}u(void 0)}))}}function c(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,s(n.key),n)}}function s(t){var e=function(t){if("object"!=o(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var r=e.call(t,"string");if("object"!=o(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==o(e)?e:e+""}var l="https://story-api.dicoding.dev/v1";const f=function(){return t=function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t)},e=[{key:"register",value:(n=u(i().mark((function t(e){var r,n,o,a,u;return i().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(r=e.name,n=e.email,o=e.password,t.prev=1,r&&n&&o){t.next=4;break}throw new Error("All fields are required");case 4:if(!(o.length<8)){t.next=6;break}throw new Error("Password must be at least 8 characters");case 6:return t.next=8,fetch("".concat(l,"/register"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({name:r.trim(),email:n.trim().toLowerCase(),password:o.trim()})});case 8:return a=t.sent,t.next=11,a.json();case 11:if(u=t.sent,a.ok){t.next=14;break}throw new Error(u.message||"Registration failed");case 14:return t.abrupt("return",u);case 17:throw t.prev=17,t.t0=t.catch(1),console.error("Registration error:",t.t0),t.t0;case 21:case"end":return t.stop()}}),t,null,[[1,17]])}))),function(t){return n.apply(this,arguments)})},{key:"login",value:(r=u(i().mark((function t(e){var r,n,o,a,u;return i().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(r=e.email,n=e.password,t.prev=1,r&&n){t.next=4;break}throw new Error("Email and password are required");case 4:return t.next=6,fetch("".concat(l,"/login"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:r.trim().toLowerCase(),password:n.trim()})});case 6:return a=t.sent,t.next=9,a.json();case 9:if(u=t.sent,a.ok){t.next=12;break}throw new Error(u.message||"Login failed");case 12:if(null!==(o=u.loginResult)&&void 0!==o&&o.token){t.next=14;break}throw new Error("Invalid server response");case 14:return localStorage.setItem("token",u.loginResult.token),localStorage.setItem("user",JSON.stringify({id:u.loginResult.userId,name:u.loginResult.name,email:r.trim().toLowerCase()})),t.abrupt("return",u);case 19:throw t.prev=19,t.t0=t.catch(1),console.error("Login error:",t.t0),t.t0;case 23:case"end":return t.stop()}}),t,null,[[1,19]])}))),function(t){return r.apply(this,arguments)})},{key:"logout",value:function(){localStorage.removeItem("token"),localStorage.removeItem("user")}},{key:"getToken",value:function(){return localStorage.getItem("token")}},{key:"isAuthenticated",value:function(){return!!this.getToken()}},{key:"getCurrentUser",value:function(){try{var t=localStorage.getItem("user");return t?JSON.parse(t):null}catch(t){return console.error("Error parsing user data:",t),null}}}],e&&c(t,e),Object.defineProperty(t,"prototype",{writable:!1}),t;var t,e,r,n}();function h(t){return h="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},h(t)}function p(){p=function(){return e};var t,e={},r=Object.prototype,n=r.hasOwnProperty,o="function"==typeof Symbol?Symbol:{},i=o.iterator||"@@iterator",a=o.asyncIterator||"@@asyncIterator",u=o.toStringTag||"@@toStringTag";function c(t,e,r,n){return Object.defineProperty(t,e,{value:r,enumerable:!n,configurable:!n,writable:!n})}try{c({},"")}catch(t){c=function(t,e,r){return t[e]=r}}function s(e,r,n,o){var i=r&&r.prototype instanceof d?r:d,a=Object.create(i.prototype);return c(a,"_invoke",function(e,r,n){var o=1;return function(i,a){if(3===o)throw Error("Generator is already running");if(4===o){if("throw"===i)throw a;return{value:t,done:!0}}for(n.method=i,n.arg=a;;){var u=n.delegate;if(u){var c=S(u,n);if(c){if(c===f)continue;return c}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if(1===o)throw o=4,n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);o=3;var s=l(e,r,n);if("normal"===s.type){if(o=n.done?4:2,s.arg===f)continue;return{value:s.arg,done:n.done}}"throw"===s.type&&(o=4,n.method="throw",n.arg=s.arg)}}}(e,n,new j(o||[])),!0),a}function l(t,e,r){try{return{type:"normal",arg:t.call(e,r)}}catch(t){return{type:"throw",arg:t}}}e.wrap=s;var f={};function d(){}function y(){}function v(){}var m={};c(m,i,(function(){return this}));var g=Object.getPrototypeOf,w=g&&g(g(O([])));w&&w!==r&&n.call(w,i)&&(m=w);var b=v.prototype=d.prototype=Object.create(m);function E(t){["next","throw","return"].forEach((function(e){c(t,e,(function(t){return this._invoke(e,t)}))}))}function x(t,e){function r(o,i,a,u){var c=l(t[o],t,i);if("throw"!==c.type){var s=c.arg,f=s.value;return f&&"object"==h(f)&&n.call(f,"__await")?e.resolve(f.__await).then((function(t){r("next",t,a,u)}),(function(t){r("throw",t,a,u)})):e.resolve(f).then((function(t){s.value=t,a(s)}),(function(t){return r("throw",t,a,u)}))}u(c.arg)}var o;c(this,"_invoke",(function(t,n){function i(){return new e((function(e,o){r(t,n,e,o)}))}return o=o?o.then(i,i):i()}),!0)}function S(e,r){var n=r.method,o=e.i[n];if(o===t)return r.delegate=null,"throw"===n&&e.i.return&&(r.method="return",r.arg=t,S(e,r),"throw"===r.method)||"return"!==n&&(r.method="throw",r.arg=new TypeError("The iterator does not provide a '"+n+"' method")),f;var i=l(o,e.i,r.arg);if("throw"===i.type)return r.method="throw",r.arg=i.arg,r.delegate=null,f;var a=i.arg;return a?a.done?(r[e.r]=a.value,r.next=e.n,"return"!==r.method&&(r.method="next",r.arg=t),r.delegate=null,f):a:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,f)}function k(t){this.tryEntries.push(t)}function _(e){var r=e[4]||{};r.type="normal",r.arg=t,e[4]=r}function j(t){this.tryEntries=[[-1]],t.forEach(k,this),this.reset(!0)}function O(e){if(null!=e){var r=e[i];if(r)return r.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var o=-1,a=function r(){for(;++o<e.length;)if(n.call(e,o))return r.value=e[o],r.done=!1,r;return r.value=t,r.done=!0,r};return a.next=a}}throw new TypeError(h(e)+" is not iterable")}return y.prototype=v,c(b,"constructor",v),c(v,"constructor",y),y.displayName=c(v,u,"GeneratorFunction"),e.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===y||"GeneratorFunction"===(e.displayName||e.name))},e.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,v):(t.__proto__=v,c(t,u,"GeneratorFunction")),t.prototype=Object.create(b),t},e.awrap=function(t){return{__await:t}},E(x.prototype),c(x.prototype,a,(function(){return this})),e.AsyncIterator=x,e.async=function(t,r,n,o,i){void 0===i&&(i=Promise);var a=new x(s(t,r,n,o),i);return e.isGeneratorFunction(r)?a:a.next().then((function(t){return t.done?t.value:a.next()}))},E(b),c(b,u,"Generator"),c(b,i,(function(){return this})),c(b,"toString",(function(){return"[object Generator]"})),e.keys=function(t){var e=Object(t),r=[];for(var n in e)r.unshift(n);return function t(){for(;r.length;)if((n=r.pop())in e)return t.value=n,t.done=!1,t;return t.done=!0,t}},e.values=O,j.prototype={constructor:j,reset:function(e){if(this.prev=this.next=0,this.sent=this._sent=t,this.done=!1,this.delegate=null,this.method="next",this.arg=t,this.tryEntries.forEach(_),!e)for(var r in this)"t"===r.charAt(0)&&n.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=t)},stop:function(){this.done=!0;var t=this.tryEntries[0][4];if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var r=this;function n(t){a.type="throw",a.arg=e,r.next=t}for(var o=r.tryEntries.length-1;o>=0;--o){var i=this.tryEntries[o],a=i[4],u=this.prev,c=i[1],s=i[2];if(-1===i[0])return n("end"),!1;if(!c&&!s)throw Error("try statement without catch or finally");if(null!=i[0]&&i[0]<=u){if(u<c)return this.method="next",this.arg=t,n(c),!0;if(u<s)return n(s),!1}}},abrupt:function(t,e){for(var r=this.tryEntries.length-1;r>=0;--r){var n=this.tryEntries[r];if(n[0]>-1&&n[0]<=this.prev&&this.prev<n[2]){var o=n;break}}o&&("break"===t||"continue"===t)&&o[0]<=e&&e<=o[2]&&(o=null);var i=o?o[4]:{};return i.type=t,i.arg=e,o?(this.method="next",this.next=o[2],f):this.complete(i)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),f},finish:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r[2]===t)return this.complete(r[4],r[3]),_(r),f}},catch:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r[0]===t){var n=r[4];if("throw"===n.type){var o=n.arg;_(r)}return o}}throw Error("illegal catch attempt")},delegateYield:function(e,r,n){return this.delegate={i:O(e),r,n},"next"===this.method&&(this.arg=t),f}},e}function d(t,e,r,n,o,i,a){try{var u=t[i](a),c=u.value}catch(t){return void r(t)}u.done?e(c):Promise.resolve(c).then(n,o)}function y(t){return function(){var e=this,r=arguments;return new Promise((function(n,o){var i=t.apply(e,r);function a(t){d(i,n,o,a,u,"next",t)}function u(t){d(i,n,o,a,u,"throw",t)}a(void 0)}))}}function v(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,m(n.key),n)}}function m(t){var e=function(t){if("object"!=h(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var r=e.call(t,"string");if("object"!=h(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==h(e)?e:e+""}var g="https://story-api.dicoding.dev/v1";const w=function(){return t=function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t)},e=[{key:"getAllStories",value:(i=y(p().mark((function t(){var e,r,n,o,i,a,u,c,s,l=arguments;return p().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(r=(e=l.length>0&&void 0!==l[0]?l[0]:{}).page,n=void 0===r?1:r,o=e.size,i=void 0===o?10:o,a=e.location,u=void 0===a?1:a,t.prev=1,c=f.getToken()){t.next=5;break}throw new Error("Authentication required");case 5:return console.log("Token:",c),t.next=8,fetch("".concat(g,"/stories?page=").concat(n,"&size=").concat(i,"&location=").concat(u),{headers:{Authorization:"Bearer ".concat(c)}});case 8:if((s=t.sent).ok){t.next=11;break}throw new Error("Failed to fetch stories");case 11:return t.next=13,s.json();case 13:return t.abrupt("return",t.sent);case 16:throw t.prev=16,t.t0=t.catch(1),console.error("Error fetching stories:",t.t0),t.t0;case 20:case"end":return t.stop()}}),t,null,[[1,16]])}))),function(){return i.apply(this,arguments)})},{key:"addStory",value:(o=y(p().mark((function t(e){var r,n,o,i,a,u,c;return p().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return r=e.description,n=e.photo,o=e.lat,i=e.lon,t.prev=1,a=f.getToken(),(u=new FormData).append("description",r),u.append("photo",n),o&&u.append("lat",o),i&&u.append("lon",i),t.next=10,fetch("".concat(g,"/stories"),{method:"POST",headers:{Authorization:"Bearer ".concat(a)},body:u});case 10:if((c=t.sent).ok){t.next=13;break}throw new Error("Failed to add story");case 13:return t.next=15,c.json();case 15:return t.abrupt("return",t.sent);case 18:throw t.prev=18,t.t0=t.catch(1),console.error("Error adding story:",t.t0),t.t0;case 22:case"end":return t.stop()}}),t,null,[[1,18]])}))),function(t){return o.apply(this,arguments)})},{key:"addStoryAsGuest",value:(n=y(p().mark((function t(e){var r,n,o,i,a,u;return p().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return r=e.description,n=e.photo,o=e.lat,i=e.lon,t.prev=1,(a=new FormData).append("description",r),a.append("photo",n),o&&a.append("lat",o),i&&a.append("lon",i),t.next=9,fetch("".concat(g,"/stories/guest"),{method:"POST",body:a});case 9:if((u=t.sent).ok){t.next=12;break}throw new Error("Failed to add story as guest");case 12:return t.next=14,u.json();case 14:return t.abrupt("return",t.sent);case 17:throw t.prev=17,t.t0=t.catch(1),console.error("Error adding guest story:",t.t0),t.t0;case 21:case"end":return t.stop()}}),t,null,[[1,17]])}))),function(t){return n.apply(this,arguments)})},{key:"getStoryById",value:(r=y(p().mark((function t(e){var r,n;return p().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(t.prev=0,r=f.getToken()){t.next=4;break}throw new Error("Authentication required");case 4:return t.next=6,fetch("".concat(g,"/stories/").concat(e),{headers:{Authorization:"Bearer ".concat(r)}});case 6:if((n=t.sent).ok){t.next=9;break}throw new Error("Failed to fetch story details");case 9:return t.next=11,n.json();case 11:return t.abrupt("return",t.sent);case 14:throw t.prev=14,t.t0=t.catch(0),console.error("Error fetching story details:",t.t0),t.t0;case 18:case"end":return t.stop()}}),t,null,[[0,14]])}))),function(t){return r.apply(this,arguments)})}],e&&v(t,e),Object.defineProperty(t,"prototype",{writable:!1}),t;var t,e,r,n,o,i}();function b(t){return b="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},b(t)}function E(){E=function(){return e};var t,e={},r=Object.prototype,n=r.hasOwnProperty,o="function"==typeof Symbol?Symbol:{},i=o.iterator||"@@iterator",a=o.asyncIterator||"@@asyncIterator",u=o.toStringTag||"@@toStringTag";function c(t,e,r,n){return Object.defineProperty(t,e,{value:r,enumerable:!n,configurable:!n,writable:!n})}try{c({},"")}catch(t){c=function(t,e,r){return t[e]=r}}function s(e,r,n,o){var i=r&&r.prototype instanceof h?r:h,a=Object.create(i.prototype);return c(a,"_invoke",function(e,r,n){var o=1;return function(i,a){if(3===o)throw Error("Generator is already running");if(4===o){if("throw"===i)throw a;return{value:t,done:!0}}for(n.method=i,n.arg=a;;){var u=n.delegate;if(u){var c=S(u,n);if(c){if(c===f)continue;return c}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if(1===o)throw o=4,n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);o=3;var s=l(e,r,n);if("normal"===s.type){if(o=n.done?4:2,s.arg===f)continue;return{value:s.arg,done:n.done}}"throw"===s.type&&(o=4,n.method="throw",n.arg=s.arg)}}}(e,n,new j(o||[])),!0),a}function l(t,e,r){try{return{type:"normal",arg:t.call(e,r)}}catch(t){return{type:"throw",arg:t}}}e.wrap=s;var f={};function h(){}function p(){}function d(){}var y={};c(y,i,(function(){return this}));var v=Object.getPrototypeOf,m=v&&v(v(O([])));m&&m!==r&&n.call(m,i)&&(y=m);var g=d.prototype=h.prototype=Object.create(y);function w(t){["next","throw","return"].forEach((function(e){c(t,e,(function(t){return this._invoke(e,t)}))}))}function x(t,e){function r(o,i,a,u){var c=l(t[o],t,i);if("throw"!==c.type){var s=c.arg,f=s.value;return f&&"object"==b(f)&&n.call(f,"__await")?e.resolve(f.__await).then((function(t){r("next",t,a,u)}),(function(t){r("throw",t,a,u)})):e.resolve(f).then((function(t){s.value=t,a(s)}),(function(t){return r("throw",t,a,u)}))}u(c.arg)}var o;c(this,"_invoke",(function(t,n){function i(){return new e((function(e,o){r(t,n,e,o)}))}return o=o?o.then(i,i):i()}),!0)}function S(e,r){var n=r.method,o=e.i[n];if(o===t)return r.delegate=null,"throw"===n&&e.i.return&&(r.method="return",r.arg=t,S(e,r),"throw"===r.method)||"return"!==n&&(r.method="throw",r.arg=new TypeError("The iterator does not provide a '"+n+"' method")),f;var i=l(o,e.i,r.arg);if("throw"===i.type)return r.method="throw",r.arg=i.arg,r.delegate=null,f;var a=i.arg;return a?a.done?(r[e.r]=a.value,r.next=e.n,"return"!==r.method&&(r.method="next",r.arg=t),r.delegate=null,f):a:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,f)}function k(t){this.tryEntries.push(t)}function _(e){var r=e[4]||{};r.type="normal",r.arg=t,e[4]=r}function j(t){this.tryEntries=[[-1]],t.forEach(k,this),this.reset(!0)}function O(e){if(null!=e){var r=e[i];if(r)return r.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var o=-1,a=function r(){for(;++o<e.length;)if(n.call(e,o))return r.value=e[o],r.done=!1,r;return r.value=t,r.done=!0,r};return a.next=a}}throw new TypeError(b(e)+" is not iterable")}return p.prototype=d,c(g,"constructor",d),c(d,"constructor",p),p.displayName=c(d,u,"GeneratorFunction"),e.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===p||"GeneratorFunction"===(e.displayName||e.name))},e.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,d):(t.__proto__=d,c(t,u,"GeneratorFunction")),t.prototype=Object.create(g),t},e.awrap=function(t){return{__await:t}},w(x.prototype),c(x.prototype,a,(function(){return this})),e.AsyncIterator=x,e.async=function(t,r,n,o,i){void 0===i&&(i=Promise);var a=new x(s(t,r,n,o),i);return e.isGeneratorFunction(r)?a:a.next().then((function(t){return t.done?t.value:a.next()}))},w(g),c(g,u,"Generator"),c(g,i,(function(){return this})),c(g,"toString",(function(){return"[object Generator]"})),e.keys=function(t){var e=Object(t),r=[];for(var n in e)r.unshift(n);return function t(){for(;r.length;)if((n=r.pop())in e)return t.value=n,t.done=!1,t;return t.done=!0,t}},e.values=O,j.prototype={constructor:j,reset:function(e){if(this.prev=this.next=0,this.sent=this._sent=t,this.done=!1,this.delegate=null,this.method="next",this.arg=t,this.tryEntries.forEach(_),!e)for(var r in this)"t"===r.charAt(0)&&n.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=t)},stop:function(){this.done=!0;var t=this.tryEntries[0][4];if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var r=this;function n(t){a.type="throw",a.arg=e,r.next=t}for(var o=r.tryEntries.length-1;o>=0;--o){var i=this.tryEntries[o],a=i[4],u=this.prev,c=i[1],s=i[2];if(-1===i[0])return n("end"),!1;if(!c&&!s)throw Error("try statement without catch or finally");if(null!=i[0]&&i[0]<=u){if(u<c)return this.method="next",this.arg=t,n(c),!0;if(u<s)return n(s),!1}}},abrupt:function(t,e){for(var r=this.tryEntries.length-1;r>=0;--r){var n=this.tryEntries[r];if(n[0]>-1&&n[0]<=this.prev&&this.prev<n[2]){var o=n;break}}o&&("break"===t||"continue"===t)&&o[0]<=e&&e<=o[2]&&(o=null);var i=o?o[4]:{};return i.type=t,i.arg=e,o?(this.method="next",this.next=o[2],f):this.complete(i)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),f},finish:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r[2]===t)return this.complete(r[4],r[3]),_(r),f}},catch:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r[0]===t){var n=r[4];if("throw"===n.type){var o=n.arg;_(r)}return o}}throw Error("illegal catch attempt")},delegateYield:function(e,r,n){return this.delegate={i:O(e),r,n},"next"===this.method&&(this.arg=t),f}},e}function x(t,e,r,n,o,i,a){try{var u=t[i](a),c=u.value}catch(t){return void r(t)}u.done?e(c):Promise.resolve(c).then(n,o)}var S={};function k(){return _.apply(this,arguments)}function _(){var t;return t=E().mark((function t(){return E().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",new Promise((function(t,e){navigator.geolocation?navigator.geolocation.getCurrentPosition((function(e){return t(e)}),(function(t){var r="Error getting your location";switch(t.code){case t.PERMISSION_DENIED:r="Location access was denied";break;case t.POSITION_UNAVAILABLE:r="Location information is unavailable";break;case t.TIMEOUT:r="Location request timed out"}e(new Error(r))}),{enableHighAccuracy:!0,timeout:1e4,maximumAge:6e4}):e(new Error("Geolocation is not supported by your browser"))})));case 1:case"end":return t.stop()}}),t)})),_=function(){var e=this,r=arguments;return new Promise((function(n,o){var i=t.apply(e,r);function a(t){x(i,n,o,a,u,"next",t)}function u(t){x(i,n,o,a,u,"throw",t)}a(void 0)}))},_.apply(this,arguments)}function j(t){S[t]&&(S[t].remove(),delete S[t]);var e=document.getElementById(t);if(!e)return console.error("Map container #".concat(t," not found")),null;e.style.height=e.style.height||"400px",e.style.width=e.style.width||"100%";var r=L.map(t,{zoomControl:!0,dragging:!0,tap:!1}).setView([-6.1754,106.8272],10);return L.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",{attribution:'&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors',maxZoom:19,minZoom:2}).addTo(r),S[t]=r,r}function O(t,e){if(t&&Array.isArray(e)){var r=e.filter((function(t){var e=Number(null==t?void 0:t.lat),r=Number(null==t?void 0:t.lon);return!isNaN(e)&&!isNaN(r)&&e>=-90&&e<=90&&r>=-180&&r<=180}));if(t.eachLayer((function(e){e instanceof L.Marker&&t.removeLayer(e)})),r.forEach((function(e){var r=e.name||"Untitled Story",n=e.description?"".concat(e.description.substring(0,100)).concat(e.description.length>100?"...":""):"No description available";L.marker([e.lat,e.lon],{title:r}).addTo(t).bindPopup('\n            <div class="map-popup">\n                <h3>'.concat(r,"</h3>\n                <p>").concat(n,"</p>\n                ").concat(e.id?'<a href="#/detail/'.concat(e.id,'" class="popup-link">View Details</a>'):"","\n            </div>\n        "))})),r.length>0){var n=L.latLngBounds(r.map((function(t){return[t.lat,t.lon]})));t.fitBounds(n,{padding:[50,50],maxZoom:15})}}}function P(t){return P="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},P(t)}function T(){T=function(){return e};var t,e={},r=Object.prototype,n=r.hasOwnProperty,o="function"==typeof Symbol?Symbol:{},i=o.iterator||"@@iterator",a=o.asyncIterator||"@@asyncIterator",u=o.toStringTag||"@@toStringTag";function c(t,e,r,n){return Object.defineProperty(t,e,{value:r,enumerable:!n,configurable:!n,writable:!n})}try{c({},"")}catch(t){c=function(t,e,r){return t[e]=r}}function s(e,r,n,o){var i=r&&r.prototype instanceof h?r:h,a=Object.create(i.prototype);return c(a,"_invoke",function(e,r,n){var o=1;return function(i,a){if(3===o)throw Error("Generator is already running");if(4===o){if("throw"===i)throw a;return{value:t,done:!0}}for(n.method=i,n.arg=a;;){var u=n.delegate;if(u){var c=E(u,n);if(c){if(c===f)continue;return c}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if(1===o)throw o=4,n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);o=3;var s=l(e,r,n);if("normal"===s.type){if(o=n.done?4:2,s.arg===f)continue;return{value:s.arg,done:n.done}}"throw"===s.type&&(o=4,n.method="throw",n.arg=s.arg)}}}(e,n,new k(o||[])),!0),a}function l(t,e,r){try{return{type:"normal",arg:t.call(e,r)}}catch(t){return{type:"throw",arg:t}}}e.wrap=s;var f={};function h(){}function p(){}function d(){}var y={};c(y,i,(function(){return this}));var v=Object.getPrototypeOf,m=v&&v(v(_([])));m&&m!==r&&n.call(m,i)&&(y=m);var g=d.prototype=h.prototype=Object.create(y);function w(t){["next","throw","return"].forEach((function(e){c(t,e,(function(t){return this._invoke(e,t)}))}))}function b(t,e){function r(o,i,a,u){var c=l(t[o],t,i);if("throw"!==c.type){var s=c.arg,f=s.value;return f&&"object"==P(f)&&n.call(f,"__await")?e.resolve(f.__await).then((function(t){r("next",t,a,u)}),(function(t){r("throw",t,a,u)})):e.resolve(f).then((function(t){s.value=t,a(s)}),(function(t){return r("throw",t,a,u)}))}u(c.arg)}var o;c(this,"_invoke",(function(t,n){function i(){return new e((function(e,o){r(t,n,e,o)}))}return o=o?o.then(i,i):i()}),!0)}function E(e,r){var n=r.method,o=e.i[n];if(o===t)return r.delegate=null,"throw"===n&&e.i.return&&(r.method="return",r.arg=t,E(e,r),"throw"===r.method)||"return"!==n&&(r.method="throw",r.arg=new TypeError("The iterator does not provide a '"+n+"' method")),f;var i=l(o,e.i,r.arg);if("throw"===i.type)return r.method="throw",r.arg=i.arg,r.delegate=null,f;var a=i.arg;return a?a.done?(r[e.r]=a.value,r.next=e.n,"return"!==r.method&&(r.method="next",r.arg=t),r.delegate=null,f):a:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,f)}function x(t){this.tryEntries.push(t)}function S(e){var r=e[4]||{};r.type="normal",r.arg=t,e[4]=r}function k(t){this.tryEntries=[[-1]],t.forEach(x,this),this.reset(!0)}function _(e){if(null!=e){var r=e[i];if(r)return r.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var o=-1,a=function r(){for(;++o<e.length;)if(n.call(e,o))return r.value=e[o],r.done=!1,r;return r.value=t,r.done=!0,r};return a.next=a}}throw new TypeError(P(e)+" is not iterable")}return p.prototype=d,c(g,"constructor",d),c(d,"constructor",p),p.displayName=c(d,u,"GeneratorFunction"),e.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===p||"GeneratorFunction"===(e.displayName||e.name))},e.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,d):(t.__proto__=d,c(t,u,"GeneratorFunction")),t.prototype=Object.create(g),t},e.awrap=function(t){return{__await:t}},w(b.prototype),c(b.prototype,a,(function(){return this})),e.AsyncIterator=b,e.async=function(t,r,n,o,i){void 0===i&&(i=Promise);var a=new b(s(t,r,n,o),i);return e.isGeneratorFunction(r)?a:a.next().then((function(t){return t.done?t.value:a.next()}))},w(g),c(g,u,"Generator"),c(g,i,(function(){return this})),c(g,"toString",(function(){return"[object Generator]"})),e.keys=function(t){var e=Object(t),r=[];for(var n in e)r.unshift(n);return function t(){for(;r.length;)if((n=r.pop())in e)return t.value=n,t.done=!1,t;return t.done=!0,t}},e.values=_,k.prototype={constructor:k,reset:function(e){if(this.prev=this.next=0,this.sent=this._sent=t,this.done=!1,this.delegate=null,this.method="next",this.arg=t,this.tryEntries.forEach(S),!e)for(var r in this)"t"===r.charAt(0)&&n.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=t)},stop:function(){this.done=!0;var t=this.tryEntries[0][4];if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var r=this;function n(t){a.type="throw",a.arg=e,r.next=t}for(var o=r.tryEntries.length-1;o>=0;--o){var i=this.tryEntries[o],a=i[4],u=this.prev,c=i[1],s=i[2];if(-1===i[0])return n("end"),!1;if(!c&&!s)throw Error("try statement without catch or finally");if(null!=i[0]&&i[0]<=u){if(u<c)return this.method="next",this.arg=t,n(c),!0;if(u<s)return n(s),!1}}},abrupt:function(t,e){for(var r=this.tryEntries.length-1;r>=0;--r){var n=this.tryEntries[r];if(n[0]>-1&&n[0]<=this.prev&&this.prev<n[2]){var o=n;break}}o&&("break"===t||"continue"===t)&&o[0]<=e&&e<=o[2]&&(o=null);var i=o?o[4]:{};return i.type=t,i.arg=e,o?(this.method="next",this.next=o[2],f):this.complete(i)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),f},finish:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r[2]===t)return this.complete(r[4],r[3]),S(r),f}},catch:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r[0]===t){var n=r[4];if("throw"===n.type){var o=n.arg;S(r)}return o}}throw Error("illegal catch attempt")},delegateYield:function(e,r,n){return this.delegate={i:_(e),r,n},"next"===this.method&&(this.arg=t),f}},e}function I(t,e,r,n,o,i,a){try{var u=t[i](a),c=u.value}catch(t){return void r(t)}u.done?e(c):Promise.resolve(c).then(n,o)}function N(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,B(n.key),n)}}function B(t){var e=function(t){if("object"!=P(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var r=e.call(t,"string");if("object"!=P(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==P(e)?e:e+""}const F=function(){return t=function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this._homeView=new n,this._showUserInfo(),this._showStories(),this._initLogoutButton()},e=[{key:"_showStories",value:(r=T().mark((function t(){var e;return T().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,this._homeView.showLoading(),t.next=4,w.getAllStories();case 4:e=t.sent,this._homeView.showStories(e.listStory),O(j("map"),e.listStory),t.next=13;break;case 10:t.prev=10,t.t0=t.catch(0),this._homeView.showError(t.t0.message);case 13:case"end":return t.stop()}}),t,this,[[0,10]])})),o=function(){var t=this,e=arguments;return new Promise((function(n,o){var i=r.apply(t,e);function a(t){I(i,n,o,a,u,"next",t)}function u(t){I(i,n,o,a,u,"throw",t)}a(void 0)}))},function(){return o.apply(this,arguments)})},{key:"_showUserInfo",value:function(){var t=f.getCurrentUser();t&&this._homeView.showUserProfile(t)}},{key:"_initLogoutButton",value:function(){var t=document.getElementById("logout-btn");t&&t.addEventListener("click",(function(){f.logout(),window.location.hash="#/login"}))}},{key:"renderStoryList",value:function(t){return'\n    <div class="story-list">\n      '.concat(t.map((function(t){return'\n        <article class="story-card" data-id="'.concat(t.id,'">\n          <img src="').concat(t.photoUrl||"assets/images/default-thumbnail.jpg",'" \n               alt="').concat(t.name,'" \n               class="story-image"\n               onerror="this.onerror=null;this.src=\'assets/images/default-thumbnail.jpg\'">\n          \n          <div class="story-content">\n            <h3>').concat(t.name,"</h3>\n            <p>").concat(t.description.substring(0,100),'...</p>\n            <button class="btn-view-detail" data-id="').concat(t.id,'">\n              View Detail\n            </button>\n          </div>\n        </article>\n      ')})).join(""),"\n    </div>\n  ")}},{key:"initViewDetailButtons",value:function(){document.querySelectorAll(".btn-view-detail").forEach((function(t){t.addEventListener("click",(function(t){var e=t.target.getAttribute("data-id");window.location.hash="#/detail/".concat(e)}))}))}}],e&&N(t.prototype,e),Object.defineProperty(t,"prototype",{writable:!1}),t;var t,e,r,o}();function G(t){return G="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},G(t)}function A(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,C(n.key),n)}}function C(t){var e=function(t){if("object"!=G(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var r=e.call(t,"string");if("object"!=G(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==G(e)?e:e+""}const D=function(){return t=function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this._renderForm()},e=[{key:"_renderForm",value:function(){document.querySelector("main").innerHTML='\n            <h2>Share Your Story</h2>\n            <form id="addStoryForm" class="add-story-form">\n                <div class="form-group">\n                    <label for="description">Story Description</label>\n                    <textarea id="description" required aria-required="true"></textarea>\n                </div>\n                \n                <div class="form-group">\n                    <label>Add Photo</label>\n                    <div class="camera-container">\n                        <video id="cameraPreview" autoplay playsinline aria-label="Camera preview"></video>\n                        <canvas id="photoCanvas" style="display: none;"></canvas>\n                        <input type="file" id="photoInput" accept="image/*" capture="environment" style="display: none;">\n                        <div class="camera-buttons">\n                            <button type="button" id="openCameraBtn" class="btn btn-secondary">Open Camera</button>\n                            <button type="button" id="captureButton" class="btn btn-primary" style="display: none;">Capture Photo</button>\n                            <button type="button" id="uploadPhotoBtn" class="btn btn-secondary">Upload Photo</button>\n                        </div>\n                    </div>\n                </div>\n                \n                <div class="form-group">\n                    <label>Location</label>\n                    <div id="add-story-map" style="height: 300px;"></div>\n                    <div style="margin-top: 1rem;">\n                        <label for="latitude">Latitude</label>\n                        <input type="text" id="latitude" readonly>\n                        <label for="longitude">Longitude</label>\n                        <input type="text" id="longitude" readonly>\n                    </div>\n                </div>\n                \n                <button type="submit" class="btn btn-primary">Share Story</button>\n            </form>\n        ',document.getElementById("openCameraBtn").addEventListener("click",(function(){document.getElementById("cameraPreview").style.display="block",document.getElementById("captureButton").style.display="inline-block",document.getElementById("openCameraBtn").style.display="none"})),document.getElementById("uploadPhotoBtn").addEventListener("click",(function(){document.getElementById("photoInput").click()})),document.getElementById("photoInput").addEventListener("change",(function(t){t.target.files.length>0&&(document.getElementById("cameraPreview").style.display="none",document.getElementById("captureButton").style.display="none",document.getElementById("openCameraBtn").style.display="inline-block")}))}},{key:"setCoordinates",value:function(t,e){document.getElementById("latitude").value=t,document.getElementById("longitude").value=e}},{key:"showLoading",value:function(){var t=document.getElementById("addStoryForm").querySelector('button[type="submit"]');t.disabled=!0,t.innerHTML='<span class="loading-spinner small"></span> Sharing...'}},{key:"showSuccess",value:function(){alert("Story shared successfully!")}},{key:"showError",value:function(t){var e=document.getElementById("addStoryForm").querySelector('button[type="submit"]');e.disabled=!1,e.textContent="Share Story",alert("Error: ".concat(t))}}],e&&A(t.prototype,e),Object.defineProperty(t,"prototype",{writable:!1}),t;var t,e}();var M=null;function V(t,e){var r=document.getElementById(t),n=document.getElementById(e);r&&n&&(navigator.mediaDevices.getUserMedia({video:!0,audio:!1}).then((function(t){M=t,r.srcObject=M,r.style.display="block"})).catch((function(t){console.error("An error occurred: "+t)})),n.addEventListener("click",(function(){!function(t){var e=document.getElementById(t),r=document.createElement("canvas"),n=document.getElementById("photoInput");e&&n&&(r.width=e.videoWidth,r.height=e.videoHeight,r.getContext("2d").drawImage(e,0,0,r.width,r.height),r.toBlob((function(t){var e=new File([t],"photo.jpg",{type:"image/jpeg"}),r=new DataTransfer;r.items.add(e),n.files=r.files;var o=new Event("change");n.dispatchEvent(o)}),"image/jpeg",.95))}(t)})))}function q(t){return q="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},q(t)}function U(){U=function(){return e};var t,e={},r=Object.prototype,n=r.hasOwnProperty,o="function"==typeof Symbol?Symbol:{},i=o.iterator||"@@iterator",a=o.asyncIterator||"@@asyncIterator",u=o.toStringTag||"@@toStringTag";function c(t,e,r,n){return Object.defineProperty(t,e,{value:r,enumerable:!n,configurable:!n,writable:!n})}try{c({},"")}catch(t){c=function(t,e,r){return t[e]=r}}function s(e,r,n,o){var i=r&&r.prototype instanceof h?r:h,a=Object.create(i.prototype);return c(a,"_invoke",function(e,r,n){var o=1;return function(i,a){if(3===o)throw Error("Generator is already running");if(4===o){if("throw"===i)throw a;return{value:t,done:!0}}for(n.method=i,n.arg=a;;){var u=n.delegate;if(u){var c=E(u,n);if(c){if(c===f)continue;return c}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if(1===o)throw o=4,n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);o=3;var s=l(e,r,n);if("normal"===s.type){if(o=n.done?4:2,s.arg===f)continue;return{value:s.arg,done:n.done}}"throw"===s.type&&(o=4,n.method="throw",n.arg=s.arg)}}}(e,n,new k(o||[])),!0),a}function l(t,e,r){try{return{type:"normal",arg:t.call(e,r)}}catch(t){return{type:"throw",arg:t}}}e.wrap=s;var f={};function h(){}function p(){}function d(){}var y={};c(y,i,(function(){return this}));var v=Object.getPrototypeOf,m=v&&v(v(_([])));m&&m!==r&&n.call(m,i)&&(y=m);var g=d.prototype=h.prototype=Object.create(y);function w(t){["next","throw","return"].forEach((function(e){c(t,e,(function(t){return this._invoke(e,t)}))}))}function b(t,e){function r(o,i,a,u){var c=l(t[o],t,i);if("throw"!==c.type){var s=c.arg,f=s.value;return f&&"object"==q(f)&&n.call(f,"__await")?e.resolve(f.__await).then((function(t){r("next",t,a,u)}),(function(t){r("throw",t,a,u)})):e.resolve(f).then((function(t){s.value=t,a(s)}),(function(t){return r("throw",t,a,u)}))}u(c.arg)}var o;c(this,"_invoke",(function(t,n){function i(){return new e((function(e,o){r(t,n,e,o)}))}return o=o?o.then(i,i):i()}),!0)}function E(e,r){var n=r.method,o=e.i[n];if(o===t)return r.delegate=null,"throw"===n&&e.i.return&&(r.method="return",r.arg=t,E(e,r),"throw"===r.method)||"return"!==n&&(r.method="throw",r.arg=new TypeError("The iterator does not provide a '"+n+"' method")),f;var i=l(o,e.i,r.arg);if("throw"===i.type)return r.method="throw",r.arg=i.arg,r.delegate=null,f;var a=i.arg;return a?a.done?(r[e.r]=a.value,r.next=e.n,"return"!==r.method&&(r.method="next",r.arg=t),r.delegate=null,f):a:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,f)}function x(t){this.tryEntries.push(t)}function S(e){var r=e[4]||{};r.type="normal",r.arg=t,e[4]=r}function k(t){this.tryEntries=[[-1]],t.forEach(x,this),this.reset(!0)}function _(e){if(null!=e){var r=e[i];if(r)return r.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var o=-1,a=function r(){for(;++o<e.length;)if(n.call(e,o))return r.value=e[o],r.done=!1,r;return r.value=t,r.done=!0,r};return a.next=a}}throw new TypeError(q(e)+" is not iterable")}return p.prototype=d,c(g,"constructor",d),c(d,"constructor",p),p.displayName=c(d,u,"GeneratorFunction"),e.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===p||"GeneratorFunction"===(e.displayName||e.name))},e.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,d):(t.__proto__=d,c(t,u,"GeneratorFunction")),t.prototype=Object.create(g),t},e.awrap=function(t){return{__await:t}},w(b.prototype),c(b.prototype,a,(function(){return this})),e.AsyncIterator=b,e.async=function(t,r,n,o,i){void 0===i&&(i=Promise);var a=new b(s(t,r,n,o),i);return e.isGeneratorFunction(r)?a:a.next().then((function(t){return t.done?t.value:a.next()}))},w(g),c(g,u,"Generator"),c(g,i,(function(){return this})),c(g,"toString",(function(){return"[object Generator]"})),e.keys=function(t){var e=Object(t),r=[];for(var n in e)r.unshift(n);return function t(){for(;r.length;)if((n=r.pop())in e)return t.value=n,t.done=!1,t;return t.done=!0,t}},e.values=_,k.prototype={constructor:k,reset:function(e){if(this.prev=this.next=0,this.sent=this._sent=t,this.done=!1,this.delegate=null,this.method="next",this.arg=t,this.tryEntries.forEach(S),!e)for(var r in this)"t"===r.charAt(0)&&n.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=t)},stop:function(){this.done=!0;var t=this.tryEntries[0][4];if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var r=this;function n(t){a.type="throw",a.arg=e,r.next=t}for(var o=r.tryEntries.length-1;o>=0;--o){var i=this.tryEntries[o],a=i[4],u=this.prev,c=i[1],s=i[2];if(-1===i[0])return n("end"),!1;if(!c&&!s)throw Error("try statement without catch or finally");if(null!=i[0]&&i[0]<=u){if(u<c)return this.method="next",this.arg=t,n(c),!0;if(u<s)return n(s),!1}}},abrupt:function(t,e){for(var r=this.tryEntries.length-1;r>=0;--r){var n=this.tryEntries[r];if(n[0]>-1&&n[0]<=this.prev&&this.prev<n[2]){var o=n;break}}o&&("break"===t||"continue"===t)&&o[0]<=e&&e<=o[2]&&(o=null);var i=o?o[4]:{};return i.type=t,i.arg=e,o?(this.method="next",this.next=o[2],f):this.complete(i)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),f},finish:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r[2]===t)return this.complete(r[4],r[3]),S(r),f}},catch:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r[0]===t){var n=r[4];if("throw"===n.type){var o=n.arg;S(r)}return o}}throw Error("illegal catch attempt")},delegateYield:function(e,r,n){return this.delegate={i:_(e),r,n},"next"===this.method&&(this.arg=t),f}},e}function R(t,e,r,n,o,i,a){try{var u=t[i](a),c=u.value}catch(t){return void r(t)}u.done?e(c):Promise.resolve(c).then(n,o)}function H(t){return function(){var e=this,r=arguments;return new Promise((function(n,o){var i=t.apply(e,r);function a(t){R(i,n,o,a,u,"next",t)}function u(t){R(i,n,o,a,u,"throw",t)}a(void 0)}))}}function z(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,Y(n.key),n)}}function Y(t){var e=function(t){if("object"!=q(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var r=e.call(t,"string");if("object"!=q(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==q(e)?e:e+""}const W=function(){return t=function t(){var e=this;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this._addStoryView=new D,this._initForm().catch((function(t){console.error("Initialization error:",t),e._addStoryView.showError("Failed to initialize form")}))},e=[{key:"_initForm",value:(n=H(U().mark((function t(){var e,r,n=this;return U().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(t.prev=0,e=j("add-story-map")){t.next=4;break}throw new Error("Failed to initialize map");case 4:return t.prev=4,t.next=7,k();case 7:r=t.sent,e.setView([r.coords.latitude,r.coords.longitude],13),t.next=15;break;case 11:t.prev=11,t.t0=t.catch(4),console.warn("Location error:",t.t0.message),e.setView([0,0],2);case 15:return e.on("click",(function(t){n._addStoryView.setCoordinates(t.latlng.lat,t.latlng.lng)})),t.prev=16,t.next=19,V("cameraPreview","captureButton");case 19:t.next=25;break;case 21:t.prev=21,t.t1=t.catch(16),console.warn("Camera error:",t.t1.message),this._addStoryView.showCameraError();case 25:document.getElementById("addStoryForm").addEventListener("submit",function(){var t=H(U().mark((function t(e){return U().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return e.preventDefault(),t.next=3,n._handleFormSubmit();case 3:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}()),t.next=33;break;case 29:throw t.prev=29,t.t2=t.catch(0),console.error("Form initialization failed:",t.t2),t.t2;case 33:case"end":return t.stop()}}),t,this,[[0,29],[4,11],[16,21]])}))),function(){return n.apply(this,arguments)})},{key:"_handleFormSubmit",value:(r=H(U().mark((function t(){var e,r,n,o;return U().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(t.prev=0,e=document.getElementById("description").value,r=document.getElementById("photoInput").files[0],n=document.getElementById("latitude").value,o=document.getElementById("longitude").value,r&&e){t.next=7;break}throw new Error("Please fill all required fields");case 7:return this._addStoryView.showLoading(),t.next=10,w.addStory({photo:r,description:e,lat:n,lon:o});case 10:this._addStoryView.showSuccess(),window.location.hash="#/home",t.next=17;break;case 14:t.prev=14,t.t0=t.catch(0),this._addStoryView.showError(t.t0.message);case 17:return t.prev=17,M&&(M.getTracks().forEach((function(t){return t.stop()})),M=null),t.finish(17);case 20:case"end":return t.stop()}}),t,this,[[0,14,17,20]])}))),function(){return r.apply(this,arguments)})}],e&&z(t.prototype,e),Object.defineProperty(t,"prototype",{writable:!1}),t;var t,e,r,n}();function J(t){return J="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},J(t)}function Z(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,K(n.key),n)}}function K(t){var e=function(t){if("object"!=J(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var r=e.call(t,"string");if("object"!=J(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==J(e)?e:e+""}const Q=function(){return t=function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t)},(e=[{key:"showLoading",value:function(){var t=document.querySelector("main");t&&(t.innerHTML='\n          <div class="loading-container">\n            <div class="loading-spinner"></div>\n            <p>Loading story details...</p>\n          </div>\n        ')}},{key:"showStory",value:function(t){var e=document.querySelector("main");if(e){var r=this._getSafeImageUrl(t.photoUrl),n=this._formatDate(t.createdAt);e.innerHTML='\n        <article class="detail-container">\n          <h1 class="detail-title">'.concat(t.name,'</h1>\n          \n          <div class="image-container">\n            <img src="').concat(r,'" \n                 alt="').concat(t.name,'" \n                 class="detail-image"\n                 onerror="this.onerror=null;this.src=\'assets/images/icons/default-image.jpg\'">\n          </div>\n          \n          <div class="detail-meta">\n            <span class="detail-date">').concat(n,'</span>\n            <span class="detail-author">By ').concat(t.author||"Anonymous",'</span>\n          </div>\n          \n          <p class="detail-description">').concat(t.description,'</p>\n          \n          <div id="detail-map" class="detail-map"></div>\n          \n          <div class="detail-actions">\n            <a href="#/home" class="btn btn-back">Back to Stories</a>\n          </div>\n        </article>\n      ')}}},{key:"showError",value:function(t){var e,r=document.querySelector("main");r&&(r.innerHTML='\n          <div class="error-container">\n            <h2>Error</h2>\n            <p>'.concat(t,'</p>\n            <div class="error-actions">\n              <a href="#/home" class="btn">Back to Home</a>\n              <button class="btn btn-retry">Try Again</button>\n            </div>\n          </div>\n        '),null===(e=document.querySelector(".btn-retry"))||void 0===e||e.addEventListener("click",(function(){window.location.reload()})))}},{key:"_getSafeImageUrl",value:function(t){return t&&"null"!==t?t:"assets/images/icons/default-image.jpg"}},{key:"_formatDate",value:function(t){try{return new Date(t).toLocaleDateString("en-US",{year:"numeric",month:"long",day:"numeric"})}catch(t){return"Unknown date"}}}])&&Z(t.prototype,e),Object.defineProperty(t,"prototype",{writable:!1}),t;var t,e}();function X(t){return X="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},X(t)}function $(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),r.push.apply(r,n)}return r}function tt(t){for(var e=1;e<arguments.length;e++){var r=null!=arguments[e]?arguments[e]:{};e%2?$(Object(r),!0).forEach((function(e){et(t,e,r[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):$(Object(r)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(r,e))}))}return t}function et(t,e,r){return(e=it(e))in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}function rt(){rt=function(){return e};var t,e={},r=Object.prototype,n=r.hasOwnProperty,o="function"==typeof Symbol?Symbol:{},i=o.iterator||"@@iterator",a=o.asyncIterator||"@@asyncIterator",u=o.toStringTag||"@@toStringTag";function c(t,e,r,n){return Object.defineProperty(t,e,{value:r,enumerable:!n,configurable:!n,writable:!n})}try{c({},"")}catch(t){c=function(t,e,r){return t[e]=r}}function s(e,r,n,o){var i=r&&r.prototype instanceof h?r:h,a=Object.create(i.prototype);return c(a,"_invoke",function(e,r,n){var o=1;return function(i,a){if(3===o)throw Error("Generator is already running");if(4===o){if("throw"===i)throw a;return{value:t,done:!0}}for(n.method=i,n.arg=a;;){var u=n.delegate;if(u){var c=E(u,n);if(c){if(c===f)continue;return c}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if(1===o)throw o=4,n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);o=3;var s=l(e,r,n);if("normal"===s.type){if(o=n.done?4:2,s.arg===f)continue;return{value:s.arg,done:n.done}}"throw"===s.type&&(o=4,n.method="throw",n.arg=s.arg)}}}(e,n,new k(o||[])),!0),a}function l(t,e,r){try{return{type:"normal",arg:t.call(e,r)}}catch(t){return{type:"throw",arg:t}}}e.wrap=s;var f={};function h(){}function p(){}function d(){}var y={};c(y,i,(function(){return this}));var v=Object.getPrototypeOf,m=v&&v(v(_([])));m&&m!==r&&n.call(m,i)&&(y=m);var g=d.prototype=h.prototype=Object.create(y);function w(t){["next","throw","return"].forEach((function(e){c(t,e,(function(t){return this._invoke(e,t)}))}))}function b(t,e){function r(o,i,a,u){var c=l(t[o],t,i);if("throw"!==c.type){var s=c.arg,f=s.value;return f&&"object"==X(f)&&n.call(f,"__await")?e.resolve(f.__await).then((function(t){r("next",t,a,u)}),(function(t){r("throw",t,a,u)})):e.resolve(f).then((function(t){s.value=t,a(s)}),(function(t){return r("throw",t,a,u)}))}u(c.arg)}var o;c(this,"_invoke",(function(t,n){function i(){return new e((function(e,o){r(t,n,e,o)}))}return o=o?o.then(i,i):i()}),!0)}function E(e,r){var n=r.method,o=e.i[n];if(o===t)return r.delegate=null,"throw"===n&&e.i.return&&(r.method="return",r.arg=t,E(e,r),"throw"===r.method)||"return"!==n&&(r.method="throw",r.arg=new TypeError("The iterator does not provide a '"+n+"' method")),f;var i=l(o,e.i,r.arg);if("throw"===i.type)return r.method="throw",r.arg=i.arg,r.delegate=null,f;var a=i.arg;return a?a.done?(r[e.r]=a.value,r.next=e.n,"return"!==r.method&&(r.method="next",r.arg=t),r.delegate=null,f):a:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,f)}function x(t){this.tryEntries.push(t)}function S(e){var r=e[4]||{};r.type="normal",r.arg=t,e[4]=r}function k(t){this.tryEntries=[[-1]],t.forEach(x,this),this.reset(!0)}function _(e){if(null!=e){var r=e[i];if(r)return r.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var o=-1,a=function r(){for(;++o<e.length;)if(n.call(e,o))return r.value=e[o],r.done=!1,r;return r.value=t,r.done=!0,r};return a.next=a}}throw new TypeError(X(e)+" is not iterable")}return p.prototype=d,c(g,"constructor",d),c(d,"constructor",p),p.displayName=c(d,u,"GeneratorFunction"),e.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===p||"GeneratorFunction"===(e.displayName||e.name))},e.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,d):(t.__proto__=d,c(t,u,"GeneratorFunction")),t.prototype=Object.create(g),t},e.awrap=function(t){return{__await:t}},w(b.prototype),c(b.prototype,a,(function(){return this})),e.AsyncIterator=b,e.async=function(t,r,n,o,i){void 0===i&&(i=Promise);var a=new b(s(t,r,n,o),i);return e.isGeneratorFunction(r)?a:a.next().then((function(t){return t.done?t.value:a.next()}))},w(g),c(g,u,"Generator"),c(g,i,(function(){return this})),c(g,"toString",(function(){return"[object Generator]"})),e.keys=function(t){var e=Object(t),r=[];for(var n in e)r.unshift(n);return function t(){for(;r.length;)if((n=r.pop())in e)return t.value=n,t.done=!1,t;return t.done=!0,t}},e.values=_,k.prototype={constructor:k,reset:function(e){if(this.prev=this.next=0,this.sent=this._sent=t,this.done=!1,this.delegate=null,this.method="next",this.arg=t,this.tryEntries.forEach(S),!e)for(var r in this)"t"===r.charAt(0)&&n.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=t)},stop:function(){this.done=!0;var t=this.tryEntries[0][4];if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var r=this;function n(t){a.type="throw",a.arg=e,r.next=t}for(var o=r.tryEntries.length-1;o>=0;--o){var i=this.tryEntries[o],a=i[4],u=this.prev,c=i[1],s=i[2];if(-1===i[0])return n("end"),!1;if(!c&&!s)throw Error("try statement without catch or finally");if(null!=i[0]&&i[0]<=u){if(u<c)return this.method="next",this.arg=t,n(c),!0;if(u<s)return n(s),!1}}},abrupt:function(t,e){for(var r=this.tryEntries.length-1;r>=0;--r){var n=this.tryEntries[r];if(n[0]>-1&&n[0]<=this.prev&&this.prev<n[2]){var o=n;break}}o&&("break"===t||"continue"===t)&&o[0]<=e&&e<=o[2]&&(o=null);var i=o?o[4]:{};return i.type=t,i.arg=e,o?(this.method="next",this.next=o[2],f):this.complete(i)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),f},finish:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r[2]===t)return this.complete(r[4],r[3]),S(r),f}},catch:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r[0]===t){var n=r[4];if("throw"===n.type){var o=n.arg;S(r)}return o}}throw Error("illegal catch attempt")},delegateYield:function(e,r,n){return this.delegate={i:_(e),r,n},"next"===this.method&&(this.arg=t),f}},e}function nt(t,e,r,n,o,i,a){try{var u=t[i](a),c=u.value}catch(t){return void r(t)}u.done?e(c):Promise.resolve(c).then(n,o)}function ot(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,it(n.key),n)}}function it(t){var e=function(t){if("object"!=X(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var r=e.call(t,"string");if("object"!=X(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==X(e)?e:e+""}const at=function(){return t=function t(e){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this._params=e,this._detailView=new Q,this._showStory()},e=[{key:"_showStory",value:(r=rt().mark((function t(){var e,r;return rt().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,this._detailView.showLoading(),t.next=4,w.getStoryById(this._params.id);case 4:if(e=t.sent){t.next=7;break}throw new Error("Story not found");case 7:r=this._processStoryData(e),this._detailView.showStory(r),this._initMapWithStory(r),t.next=16;break;case 12:t.prev=12,t.t0=t.catch(0),console.error("Failed to load story:",t.t0),this._detailView.showError(t.t0.message||"Failed to load story details");case 16:case"end":return t.stop()}}),t,this,[[0,12]])})),n=function(){var t=this,e=arguments;return new Promise((function(n,o){var i=r.apply(t,e);function a(t){nt(i,n,o,a,u,"next",t)}function u(t){nt(i,n,o,a,u,"throw",t)}a(void 0)}))},function(){return n.apply(this,arguments)})},{key:"_processStoryData",value:function(t){return tt(tt({},t),{},{name:t.name||"Unknown Story",description:t.description||"No description available",photoUrl:t.photoUrl||"assets/images/icons/default-image.jpg",createdAt:t.createdAt||(new Date).toISOString(),lat:t.lat||-6.2088,lon:t.lon||106.8456})}},{key:"_initMapWithStory",value:function(t){setTimeout((function(){try{var e=j("detail-map");e&&t.lat&&t.lon&&function(t,e){if(t&&t.setView&&null!=e&&e.lat&&null!=e&&e.lon){var r=Number(e.lat),n=Number(e.lon);if(isNaN(r)||isNaN(n)||r<-90||r>90||n<-180||n>180)console.error("Invalid coordinates:",e.lat,e.lon);else{t.setView([r,n],13),t.eachLayer((function(e){e instanceof L.Marker&&t.removeLayer(e)}));var o=e.name||"Unknown Story",i=e.description?"".concat(e.description.substring(0,100)).concat(e.description.length>100?"...":""):"No description available";L.marker([r,n],{title:o,alt:"Story location: ".concat(o)}).addTo(t).bindPopup('\n        <div class="map-popup">\n            <h3>'.concat(o,"</h3>\n            <p>").concat(i,"</p>\n        </div>\n    ")).openPopup()}}else console.error("Invalid map or story data")}(e,t)}catch(t){console.error("Map initialization error:",t)}}),50)}}],e&&ot(t.prototype,e),Object.defineProperty(t,"prototype",{writable:!1}),t;var t,e,r,n}();function ut(t){return ut="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},ut(t)}function ct(){ct=function(){return e};var t,e={},r=Object.prototype,n=r.hasOwnProperty,o="function"==typeof Symbol?Symbol:{},i=o.iterator||"@@iterator",a=o.asyncIterator||"@@asyncIterator",u=o.toStringTag||"@@toStringTag";function c(t,e,r,n){return Object.defineProperty(t,e,{value:r,enumerable:!n,configurable:!n,writable:!n})}try{c({},"")}catch(t){c=function(t,e,r){return t[e]=r}}function s(e,r,n,o){var i=r&&r.prototype instanceof h?r:h,a=Object.create(i.prototype);return c(a,"_invoke",function(e,r,n){var o=1;return function(i,a){if(3===o)throw Error("Generator is already running");if(4===o){if("throw"===i)throw a;return{value:t,done:!0}}for(n.method=i,n.arg=a;;){var u=n.delegate;if(u){var c=E(u,n);if(c){if(c===f)continue;return c}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if(1===o)throw o=4,n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);o=3;var s=l(e,r,n);if("normal"===s.type){if(o=n.done?4:2,s.arg===f)continue;return{value:s.arg,done:n.done}}"throw"===s.type&&(o=4,n.method="throw",n.arg=s.arg)}}}(e,n,new k(o||[])),!0),a}function l(t,e,r){try{return{type:"normal",arg:t.call(e,r)}}catch(t){return{type:"throw",arg:t}}}e.wrap=s;var f={};function h(){}function p(){}function d(){}var y={};c(y,i,(function(){return this}));var v=Object.getPrototypeOf,m=v&&v(v(_([])));m&&m!==r&&n.call(m,i)&&(y=m);var g=d.prototype=h.prototype=Object.create(y);function w(t){["next","throw","return"].forEach((function(e){c(t,e,(function(t){return this._invoke(e,t)}))}))}function b(t,e){function r(o,i,a,u){var c=l(t[o],t,i);if("throw"!==c.type){var s=c.arg,f=s.value;return f&&"object"==ut(f)&&n.call(f,"__await")?e.resolve(f.__await).then((function(t){r("next",t,a,u)}),(function(t){r("throw",t,a,u)})):e.resolve(f).then((function(t){s.value=t,a(s)}),(function(t){return r("throw",t,a,u)}))}u(c.arg)}var o;c(this,"_invoke",(function(t,n){function i(){return new e((function(e,o){r(t,n,e,o)}))}return o=o?o.then(i,i):i()}),!0)}function E(e,r){var n=r.method,o=e.i[n];if(o===t)return r.delegate=null,"throw"===n&&e.i.return&&(r.method="return",r.arg=t,E(e,r),"throw"===r.method)||"return"!==n&&(r.method="throw",r.arg=new TypeError("The iterator does not provide a '"+n+"' method")),f;var i=l(o,e.i,r.arg);if("throw"===i.type)return r.method="throw",r.arg=i.arg,r.delegate=null,f;var a=i.arg;return a?a.done?(r[e.r]=a.value,r.next=e.n,"return"!==r.method&&(r.method="next",r.arg=t),r.delegate=null,f):a:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,f)}function x(t){this.tryEntries.push(t)}function S(e){var r=e[4]||{};r.type="normal",r.arg=t,e[4]=r}function k(t){this.tryEntries=[[-1]],t.forEach(x,this),this.reset(!0)}function _(e){if(null!=e){var r=e[i];if(r)return r.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var o=-1,a=function r(){for(;++o<e.length;)if(n.call(e,o))return r.value=e[o],r.done=!1,r;return r.value=t,r.done=!0,r};return a.next=a}}throw new TypeError(ut(e)+" is not iterable")}return p.prototype=d,c(g,"constructor",d),c(d,"constructor",p),p.displayName=c(d,u,"GeneratorFunction"),e.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===p||"GeneratorFunction"===(e.displayName||e.name))},e.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,d):(t.__proto__=d,c(t,u,"GeneratorFunction")),t.prototype=Object.create(g),t},e.awrap=function(t){return{__await:t}},w(b.prototype),c(b.prototype,a,(function(){return this})),e.AsyncIterator=b,e.async=function(t,r,n,o,i){void 0===i&&(i=Promise);var a=new b(s(t,r,n,o),i);return e.isGeneratorFunction(r)?a:a.next().then((function(t){return t.done?t.value:a.next()}))},w(g),c(g,u,"Generator"),c(g,i,(function(){return this})),c(g,"toString",(function(){return"[object Generator]"})),e.keys=function(t){var e=Object(t),r=[];for(var n in e)r.unshift(n);return function t(){for(;r.length;)if((n=r.pop())in e)return t.value=n,t.done=!1,t;return t.done=!0,t}},e.values=_,k.prototype={constructor:k,reset:function(e){if(this.prev=this.next=0,this.sent=this._sent=t,this.done=!1,this.delegate=null,this.method="next",this.arg=t,this.tryEntries.forEach(S),!e)for(var r in this)"t"===r.charAt(0)&&n.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=t)},stop:function(){this.done=!0;var t=this.tryEntries[0][4];if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var r=this;function n(t){a.type="throw",a.arg=e,r.next=t}for(var o=r.tryEntries.length-1;o>=0;--o){var i=this.tryEntries[o],a=i[4],u=this.prev,c=i[1],s=i[2];if(-1===i[0])return n("end"),!1;if(!c&&!s)throw Error("try statement without catch or finally");if(null!=i[0]&&i[0]<=u){if(u<c)return this.method="next",this.arg=t,n(c),!0;if(u<s)return n(s),!1}}},abrupt:function(t,e){for(var r=this.tryEntries.length-1;r>=0;--r){var n=this.tryEntries[r];if(n[0]>-1&&n[0]<=this.prev&&this.prev<n[2]){var o=n;break}}o&&("break"===t||"continue"===t)&&o[0]<=e&&e<=o[2]&&(o=null);var i=o?o[4]:{};return i.type=t,i.arg=e,o?(this.method="next",this.next=o[2],f):this.complete(i)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),f},finish:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r[2]===t)return this.complete(r[4],r[3]),S(r),f}},catch:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r[0]===t){var n=r[4];if("throw"===n.type){var o=n.arg;S(r)}return o}}throw Error("illegal catch attempt")},delegateYield:function(e,r,n){return this.delegate={i:_(e),r,n},"next"===this.method&&(this.arg=t),f}},e}function st(t,e,r,n,o,i,a){try{var u=t[i](a),c=u.value}catch(t){return void r(t)}u.done?e(c):Promise.resolve(c).then(n,o)}function lt(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,ft(n.key),n)}}function ft(t){var e=function(t){if("object"!=ut(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var r=e.call(t,"string");if("object"!=ut(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==ut(e)?e:e+""}const ht=function(){return t=function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"login";!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.mode=e,this._render()},e=[{key:"_render",value:function(){var t=document.getElementById("auth-view");t&&(t.innerHTML='\n      <div class="auth-container">\n        <h2>'.concat("login"===this.mode?"Login":"Register",'</h2>\n        <form id="auth-form">\n          ').concat("register"===this.mode?'\n            <div class="form-group">\n              <label for="name">Name</label>\n              <input type="text" id="name" required>\n            </div>\n            <div class="form-group">\n              <label for="confirm-password">Confirm Password</label>\n              <input type="password" id="confirm-password" required minlength="8">\n            </div>\n          ':"",'\n          <div class="form-group">\n            <label for="email">Email</label>\n            <input type="email" id="email" required>\n          </div>\n          <div class="form-group">\n            <label for="password">Password</label>\n            <input type="password" id="password" required minlength="8">\n          </div>\n          <button type="submit" class="btn btn-primary">\n            ').concat("login"===this.mode?"Login":"Register",'\n          </button>\n        </form>\n        <div class="auth-footer">\n          ').concat("login"===this.mode?'Belum punya akun? <a href="#/register">Daftar disini</a>':'Sudah punya akun? <a href="#/login">Login disini</a>',"\n        </div>\n      </div>\n    "),this._initForm())}},{key:"_initForm",value:function(){var t=this,e=document.getElementById("auth-form");e&&e.addEventListener("submit",function(){var r,n=(r=ct().mark((function r(n){var o,i,a,u,c;return ct().wrap((function(r){for(;;)switch(r.prev=r.next){case 0:if(n.preventDefault(),o=e.querySelector('button[type="submit"]'),r.prev=2,o.disabled=!0,o.textContent="Processing...",i=document.getElementById("email").value,a=document.getElementById("password").value,"login"!==t.mode){r.next=13;break}return r.next=10,f.login({email:i,password:a});case 10:window.location.hash="#/home",r.next=21;break;case 13:if(u=document.getElementById("name").value,c=document.getElementById("confirm-password").value,a===c){r.next=17;break}throw new Error("Passwords do not match");case 17:return r.next=19,f.register({name:u,email:i,password:a});case 19:alert("Registration successful! Please login."),window.location.hash="#/login";case 21:r.next=26;break;case 23:r.prev=23,r.t0=r.catch(2),alert("Error: ".concat(r.t0.message));case 26:return r.prev=26,o.disabled=!1,o.textContent="login"===t.mode?"Login":"Register",r.finish(26);case 30:case"end":return r.stop()}}),r,null,[[2,23,26,30]])})),function(){var t=this,e=arguments;return new Promise((function(n,o){var i=r.apply(t,e);function a(t){st(i,n,o,a,u,"next",t)}function u(t){st(i,n,o,a,u,"throw",t)}a(void 0)}))});return function(t){return n.apply(this,arguments)}}())}}],e&&lt(t.prototype,e),Object.defineProperty(t,"prototype",{writable:!1}),t;var t,e}();function pt(t){return pt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},pt(t)}function dt(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,yt(n.key),n)}}function yt(t){var e=function(t){if("object"!=pt(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var r=e.call(t,"string");if("object"!=pt(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==pt(e)?e:e+""}var vt={"/home":{template:'<div id="home-view"></div>',presenter:F,auth:!0},"/login":{template:'<div id="auth-view"></div>',init:function(){return new ht("login")}},"/register":{template:'<div id="auth-view"></div>',init:function(){return new ht("register")}},"/add":{template:'<div id="add-story-view"></div>',presenter:W,auth:!0},"/detail/:id":{template:'<div id="detail-view"></div>',presenter:at,auth:!0},default:{template:'<div id="home-view"></div>',presenter:F,auth:!0}};const mt=function(){return t=function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.initRouter(),this.initAppShell(),this.loadRoute()},(e=[{key:"initRouter",value:function(){var t=this;window.addEventListener("hashchange",(function(){return t.loadRoute()}))}},{key:"initAppShell",value:function(){var t=document.getElementById("hamburgerButton"),e=document.getElementById("navigationDrawer");t.addEventListener("click",(function(t){e.classList.toggle("open"),t.stopPropagation()})),document.addEventListener("click",(function(){e.classList.remove("open")}))}},{key:"loadRoute",value:function(){try{var t=window.location.hash.substring(1)||"/login",e=this.getRoute(t);if(e.auth&&!f.isAuthenticated())return void(window.location.hash="#/login");var r=document.querySelector("main");if(!r)throw new Error("Main content element not found");if(r.innerHTML=e.template,e.init)e.init();else if(e.presenter){var n=this.extractParams(t);new e.presenter(n)}}catch(t){console.error("Routing error:",t),this.showErrorPage(t)}}},{key:"getRoute",value:function(t){return t.startsWith("/detail/")?vt["/detail/:id"]:vt[t]||vt.default}},{key:"extractParams",value:function(t){if(t.startsWith("/detail/")){var e=t.split("/")[2];if(!e)throw new Error("Invalid story ID");return{id:e}}return{}}},{key:"showErrorPage",value:function(t){var e=document.querySelector("main");e&&(e.innerHTML='\n        <div class="error-container">\n          <h2>Error</h2>\n          <p>'.concat(t.message,'</p>\n          <div class="error-actions">\n            <a href="#/home" class="btn">Home</a>\n            <a href="#/login" class="btn">Login</a>\n          </div>\n        </div>\n      '))}}])&&dt(t.prototype,e),Object.defineProperty(t,"prototype",{writable:!1}),t;var t,e}();document.addEventListener("DOMContentLoaded",(function(){document.querySelector("main")||(document.body.innerHTML='<main id="main-content"></main>'),new mt}))})();